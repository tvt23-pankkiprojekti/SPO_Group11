<!-- localStorage.getItem("token") --> 
<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link rel="stylesheet" href="/css/style.css">
    </head>
        <body>
            <h1>User</h1>
            <table id="userTable"></table>

            <h1>Transaction</h1>
            <table id="transaction">
                <tr>
                    <th>idTransaction</th>
                    <th>Account_id</th>
                    <th>dateTime</th>
                    <th>balanceChange</th>
                    <th>transactionType</th>
                    <th><a href="new.html?table=transaction"><button name = "addTransaction" type = "button">AddNew</button></a></th>
                </tr>
            </table>
            <h1>Account</h1>
            <table id="account">
                <tr>
                    <th>idAccount</th>
                    <th>User_id</th>
                    <th>type</th>
                    <th>balance</th>
                    <th>limit</th>
                    <th>accountNumber</th>
                    <th><a href="new.html?table=account"><button name = "addAccount" type = "button">AddNew</button></a></th>
                </tr>
            </table>
            <h1>Card Account</h1>
            <table id="card_account">
                <tr>
                    <th>idCard_Account</th>
                    <th>Card_id</th>
                    <th>Account_id</th>
                    <th><a href="new.html?table=card_account"><button name = "addCardAccount" type = "button">AddNew</button></a></th>
                </tr>
            </table>
        </body>
    <script>
        const token = localStorage.getItem("token");
        const userTable = document.getElementById("userTable");
        const testButton = document.getElementById("testButton");
    
        
        async function getDataTransaction(){
            const res = await fetch('admin/api/transaction', {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": token
                }
            });

            const data = await res.json();
            
            const idTransactions = data.map(item => item.idTransaction);
            const accountIds = data.map(item => item.Account_id);
            const dateTimes = data.map(item => item.dateTime);
            const transactiontypes = data.map(item => item.transactionType);
            const balanceChanges = data.map(item => item.balanceChange);
            const dataLenght = data.length;

            const informationArray = [idTransactions, accountIds, dateTimes, balanceChanges, transactiontypes];
            const arrayLenght = informationArray.length;

            await tableCreator(informationArray, arrayLenght, dataLenght, "transaction");
            
        }
        window.addEventListener("load", getDataTransaction);


        async function getDataAccount(){
            const res = await fetch('admin/api/account', {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": token
                }
            });

            const data = await res.json();

            const idAccounts = data.map(item => item.idAccount);
            const usedIds = data.map(item => item.User_id);
            const types = data.map(item => item.type);
            const balances = data.map(item => item.balance);
            const limits = data.map(item => item.limit);
            const accountNumbers = data.map(item => item.accountNumber);
            const dataLenght = data.length;

            const informationArray = [idAccounts, usedIds, types, balances, limits, accountNumbers];
            const arrayLenght = informationArray.length;

            await tableCreator(informationArray, arrayLenght, dataLenght, "account");
        
        }
        window.addEventListener("load", getDataAccount);

        async function getDataCardAccount(){
            const res = await fetch('admin/api/card_account', {
                headers: {
                    "Content-Type": "application/json",
                    "Accept": "application/json",
                    "Authorization": token
                }
            });

            const data = await res.json();
            
            const cardAccountIds = data.map(item => item.idCard_Account);
            const cardIds = data.map(item => item.Card_id);
            const accountIds = data.map(item => item.Account_id);
            const dataLenght = data.length;

            const informationArray = [cardAccountIds, cardIds, accountIds];
            const arrayLenght = informationArray.length;

            await tableCreator(informationArray, arrayLenght, dataLenght, "card_account");
        }
        window.addEventListener("load", getDataCardAccount);
        

        async function tableCreator(infoArray, arrayLenght, dataLenght, tableName) {
            const trTable = document.getElementById(tableName);

            for(let i=0; i < dataLenght; i++){
                // a new table row
                const tr = document.createElement('tr');
                for (let j=0; j < arrayLenght; j++){
                    // a new data cell/item/value what ever you want to call it
                    const td = document.createElement('td');
                    td.textContent = infoArray[j][i];
                    tr.appendChild(td);
                }
                // button creation
                const buttonTd = document.createElement('td');
                const button = document.createElement('button');
                const linkki = document.createElement('a');
                linkki.href = `/row.html?table=${tableName}&row=${infoArray[0][i]}`;
                button.append("Edit");
                linkki.appendChild(button);
                buttonTd.appendChild(linkki);
                tr.appendChild(buttonTd);

                trTable.append(tr);
            }
        }



    </script>
</html>